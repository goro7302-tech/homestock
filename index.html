<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="HomeStock">
  <meta name="theme-color" content="#10b981">
  <meta name="description" content="Smart inventory management for your home. Track food, appliances, and daily supplies with expiry notifications.">
  <title>HomeStock - Smart Home Inventory</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEyOCIgaGVpZ2h0PSIxMjgiIHJ4PSIyNCIgZmlsbD0iIzEwYjk4MSIvPjxwYXRoIGQ9Ik02NCAxNkw0MCw0MEg1NlY4MEg3MlY0MEg4OEw2NCwxNloiIGZpbGw9IndoaXRlIi8+PHBhdGggZD0iTTMyIDk2SDk2VjExMkgzMlY5NloiIGZpbGw9IndoaXRlIi8+PC9zdmc+">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

  <style>
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      overscroll-behavior: none;
      -webkit-overflow-scrolling: touch;
    }
    input, select, textarea, button { font-size: 16px !important; }
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .install-prompt { animation: slideUp 0.3s ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.3s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const { Plus, Search, Package, Trash2, Calendar, MapPin, Tag, ShoppingCart, Bell, X, Download, Globe, Crown, Zap, Check, LogOut, Mail, Lock, Eye, EyeOff, User } = (() => {
      const createIcon = (path) => ({ size = 24, color = 'currentColor', style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
          {path}
        </svg>
      );
      return {
        Plus: createIcon(<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>),
        Search: createIcon(<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>),
        Package: createIcon(<><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></>),
        Trash2: createIcon(<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></>),
        Calendar: createIcon(<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>),
        MapPin: createIcon(<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>),
        Tag: createIcon(<><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></>),
        ShoppingCart: createIcon(<><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></>),
        Bell: createIcon(<><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></>),
        X: createIcon(<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>),
        Download: createIcon(<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></>),
        Globe: createIcon(<><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></>),
        Crown: createIcon(<><path d="M2 12l3-3 4 4 4-4 4 4 3-3v9H2z"/><path d="M2 21h20"/></>),
        Zap: createIcon(<><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></>),
        Check: createIcon(<><polyline points="20 6 9 17 4 12"/></>),
        LogOut: createIcon(<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>),
        Mail: createIcon(<><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></>),
        Lock: createIcon(<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>),
        Eye: createIcon(<><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></>),
        EyeOff: createIcon(<><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></>),
        User: createIcon(<><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>),
      };
    })();

    // Translations
    const translations = {
      ja: {
        appName: 'HomeStock',
        tagline: '„ÅÑ„Åæ„ÄÅÂÆ∂„Å´‰Ωï„Åå„ÅÇ„Çã?„Çí„Éù„Ç±„ÉÉ„Éà„Å´„ÄÇ',
        add: 'ËøΩÂä†',
        searchPlaceholder: 'ÂïÜÂìÅÂêç„ÇÑÂ∫óÂêç„ÅßÊ§úÁ¥¢...',
        allCategories: 'ÂÖ®„Ç´„ÉÜ„Ç¥„É™„Éº',
        allLocations: 'ÂÖ®‰øùÁÆ°Â†¥ÊâÄ',
        noItems: '„Åæ„Å†„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',
        noItemsDesc: '„ÄåËøΩÂä†„Äç„Éú„Çø„É≥„Åã„ÇâÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÁôªÈå≤„Åó„Åæ„Åó„Çá„ÅÜ',
        noResults: 'Ë©≤ÂΩì„Åô„Çã„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',
        noResultsDesc: 'Ê§úÁ¥¢Êù°‰ª∂„ÇíÂ§âÊõ¥„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ',
        expiryNotifications: 'ÊúüÈôêÈÄöÁü•',
        noExpiring: 'ÊúüÈôê„ÅåËøë„ÅÑ„Ç¢„Ç§„ÉÜ„É†„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
        expired: 'ÊúüÈôêÂàá„Çå',
        expiryToday: 'Êú¨Êó•ÊúüÈôê',
        daysLeft: 'ÊÆã„Çä{days}Êó•',
        categories: { food: 'È£üÊñôÂìÅ', appliance: 'ÂÆ∂Èõª', daily: 'Êó•Áî®ÂìÅ' },
        locations: {
          refrigerator: 'ÂÜ∑ËîµÂ∫´', freezer: 'ÂÜ∑ÂáçÂ∫´', pantry: '„Éë„É≥„Éà„É™„Éº',
          kitchen: '„Ç≠„ÉÉ„ÉÅ„É≥', bathroom: 'Ê¥óÈù¢ÊâÄ', storage: 'ÂèéÁ¥ç', other: '„Åù„ÅÆ‰ªñ'
        },
        addItem: 'Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†„ÇíËøΩÂä†',
        itemName: 'ÂïÜÂìÅÂêç', itemNamePlaceholder: '‰æã: Áâõ‰π≥„ÄÅ„ÉÜ„Ç£„ÉÉ„Ç∑„É•„Éö„Éº„Éë„Éº',
        category: '„Ç´„ÉÜ„Ç¥„É™„Éº', quantity: 'Êï∞Èáè', price: '‰æ°Ê†º (ÂÜÜ)',
        optional: '‰ªªÊÑè', purchaseDate: 'Ë≥ºÂÖ•Êó•', expiryDate: 'Ê∂àË≤ªÊúüÈôê',
        location: '‰øùÁÆ°Â†¥ÊâÄ', store: 'Ë≥ºÂÖ•Â∫ó', storePlaceholder: '‰æã: „Ç≥„Çπ„Éà„Ç≥',
        notes: '„É°„É¢', notesPlaceholder: 'Ëá™Áî±„Å´„É°„É¢„ÇíË®òÂÖ•',
        cancel: '„Ç≠„É£„É≥„Çª„É´', addButton: 'ËøΩÂä†„Åô„Çã',
        deleteConfirm: '„Åì„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?',
        itemsRemaining: 'ÊÆã„Çä{count}ÂÄãÁôªÈå≤ÂèØËÉΩ',
        upgradePrompt: '„ÇÇ„Å£„Å®ÁôªÈå≤„Åô„Çã„Å´„ÅØ„Éó„É¨„Éü„Ç¢„É†„Å∏',
        freePlan: 'ÁÑ°Êñô„Éó„É©„É≥', premiumPlan: '„Éó„É¨„Éü„Ç¢„É†', proPlan: '„Éó„É≠',
        perMonth: '/Êúà', perYear: '/Âπ¥', comingSoon: 'ËøëÊó•ÂÖ¨Èñã',
        upgrade: '„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ', exportData: '„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà',
        installApp: '„Ç¢„Éó„É™„Çí„Ç§„É≥„Çπ„Éà„Éº„É´',
        installDesc: '„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Åó„Å¶„Ç¢„Éó„É™„ÅÆ„Çà„ÅÜ„Å´‰Ωø„Åà„Åæ„Åô',
        install: '„Ç§„É≥„Çπ„Éà„Éº„É´', later: 'Âæå„Åß',
        // Auth
        login: '„É≠„Ç∞„Ç§„É≥', signup: '„Ç¢„Ç´„Ç¶„É≥„Éà‰ΩúÊàê', logout: '„É≠„Ç∞„Ç¢„Ç¶„Éà',
        email: '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', password: '„Éë„Çπ„ÉØ„Éº„Éâ', confirmPassword: '„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÔºâ',
        loginWithGoogle: 'Google„Åß„É≠„Ç∞„Ç§„É≥',
        noAccount: '„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÊñπ', haveAccount: 'Êó¢„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„ÅÆÊñπ',
        loginWelcome: '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ', signupWelcome: '„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰ΩúÊàê',
        loginDesc: 'HomeStock„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶Âú®Â∫´„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ',
        signupDesc: 'ÁÑ°Êñô„Åß„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰ΩúÊàê„Åó„Å¶ÂÆ∂„ÅÆÂú®Â∫´„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ',
        passwordMismatch: '„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì',
        loading: 'Ë™≠„ÅøËæº„Åø‰∏≠...',
        syncingData: '„Éá„Éº„Çø„ÇíÂêåÊúü‰∏≠...',
      },
      en: {
        appName: 'HomeStock',
        tagline: "What's in your home? In your pocket.",
        add: 'Add', searchPlaceholder: 'Search by name or store...',
        allCategories: 'All Categories', allLocations: 'All Locations',
        noItems: 'No items yet', noItemsDesc: 'Tap "Add" to register your first item',
        noResults: 'No matching items', noResultsDesc: 'Try changing your search criteria',
        expiryNotifications: 'Expiry Alerts', noExpiring: 'No items expiring soon',
        expired: 'Expired', expiryToday: 'Expires today', daysLeft: '{days} days left',
        categories: { food: 'Food', appliance: 'Appliances', daily: 'Daily Supplies' },
        locations: {
          refrigerator: 'Refrigerator', freezer: 'Freezer', pantry: 'Pantry',
          kitchen: 'Kitchen', bathroom: 'Bathroom', storage: 'Storage', other: 'Other'
        },
        addItem: 'Add New Item', itemName: 'Item Name', itemNamePlaceholder: 'e.g., Milk, Tissues',
        category: 'Category', quantity: 'Quantity', price: 'Price',
        optional: 'Optional', purchaseDate: 'Purchase Date', expiryDate: 'Expiry Date',
        location: 'Location', store: 'Store', storePlaceholder: 'e.g., Costco',
        notes: 'Notes', notesPlaceholder: 'Add notes here',
        cancel: 'Cancel', addButton: 'Add Item', deleteConfirm: 'Delete this item?',
        itemsRemaining: '{count} items remaining', upgradePrompt: 'Upgrade to add more',
        freePlan: 'Free', premiumPlan: 'Premium', proPlan: 'Pro',
        perMonth: '/mo', perYear: '/yr', comingSoon: 'Coming Soon',
        upgrade: 'Upgrade', exportData: 'Export Data',
        installApp: 'Install App', installDesc: 'Add to home screen for app-like experience',
        install: 'Install', later: 'Later',
        // Auth
        login: 'Login', signup: 'Sign Up', logout: 'Logout',
        email: 'Email', password: 'Password', confirmPassword: 'Confirm Password',
        loginWithGoogle: 'Continue with Google',
        noAccount: "Don't have an account?", haveAccount: 'Already have an account?',
        loginWelcome: 'Welcome back', signupWelcome: 'Create account',
        loginDesc: 'Log in to HomeStock to manage your inventory',
        signupDesc: 'Create a free account to manage your home inventory',
        passwordMismatch: 'Passwords do not match',
        loading: 'Loading...',
        syncingData: 'Syncing data...',
      }
    };

    // ===== AUTH SCREEN =====
    const AuthScreen = ({ language, onLanguageToggle }) => {
      const t = translations[language];
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [showPassword, setShowPassword] = useState(false);
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleEmailAuth = async (e) => {
        e.preventDefault();
        setError('');
        if (!isLogin && password !== confirmPassword) {
          setError(t.passwordMismatch);
          return;
        }
        setLoading(true);
        try {
          if (isLogin) {
            await auth.signInWithEmailAndPassword(email, password);
          } else {
            await auth.createUserWithEmailAndPassword(email, password);
          }
        } catch (err) {
          const msgs = {
            'auth/user-not-found': language === 'ja' ? '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì' : 'Email not found',
            'auth/wrong-password': language === 'ja' ? '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô' : 'Wrong password',
            'auth/email-already-in-use': language === 'ja' ? '„Åì„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô' : 'Email already in use',
            'auth/weak-password': language === 'ja' ? '„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ6ÊñáÂ≠ó‰ª•‰∏ä„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ' : 'Password must be at least 6 characters',
            'auth/invalid-email': language === 'ja' ? '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì' : 'Invalid email address',
            'auth/invalid-credential': language === 'ja' ? '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô' : 'Invalid email or password',
          };
          setError(msgs[err.code] || err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleGoogleLogin = async () => {
        setError('');
        setLoading(true);
        try {
          const provider = new firebase.auth.GoogleAuthProvider();
          await auth.signInWithPopup(provider);
        } catch (err) {
          if (err.code !== 'auth/popup-closed-by-user') {
            setError(err.message);
          }
        } finally {
          setLoading(false);
        }
      };

      return (
        <div style={{
          minHeight: '100vh',
          background: 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #f0fdfa 100%)',
          display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',
          padding: '1.5rem', fontFamily: "'Outfit', -apple-system, BlinkMacSystemFont, sans-serif"
        }}>
          {/* Language Toggle */}
          <div style={{ position: 'absolute', top: '1.5rem', right: '1.5rem' }}>
            <button onClick={onLanguageToggle} style={{
              background: 'white', border: '1px solid #e5e7eb', borderRadius: '10px',
              padding: '0.5rem 0.75rem', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.25rem',
              fontSize: '0.75rem', fontWeight: '600'
            }}>
              <Globe size={16} />
              {language.toUpperCase()}
            </button>
          </div>

          {/* Logo */}
          <div style={{ textAlign: 'center', marginBottom: '2rem' }} className="fade-in">
            <div style={{
              width: '64px', height: '64px', margin: '0 auto 1rem',
              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
              borderRadius: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center',
              boxShadow: '0 8px 24px rgba(16, 185, 129, 0.3)'
            }}>
              <Package color="white" size={36} />
            </div>
            <h1 style={{
              fontSize: '2rem', fontWeight: '700', margin: '0 0 0.25rem',
              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
              WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent'
            }}>HomeStock</h1>
            <p style={{ color: '#6b7280', margin: 0, fontSize: '0.9rem' }}>{t.tagline}</p>
          </div>

          {/* Card */}
          <div style={{
            background: 'white', borderRadius: '20px', padding: '2rem',
            width: '100%', maxWidth: '400px',
            boxShadow: '0 10px 40px rgba(0,0,0,0.08)', border: '1px solid rgba(0,0,0,0.05)'
          }} className="fade-in">
            <h2 style={{ fontSize: '1.5rem', fontWeight: '700', margin: '0 0 0.5rem' }}>
              {isLogin ? t.loginWelcome : t.signupWelcome}
            </h2>
            <p style={{ color: '#6b7280', margin: '0 0 1.5rem', fontSize: '0.9rem' }}>
              {isLogin ? t.loginDesc : t.signupDesc}
            </p>

            {/* Google Login */}
            <button onClick={handleGoogleLogin} disabled={loading} style={{
              width: '100%', padding: '0.875rem', background: 'white',
              border: '1.5px solid #e5e7eb', borderRadius: '12px',
              display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.75rem',
              fontWeight: '600', fontSize: '0.95rem', cursor: 'pointer', marginBottom: '1.25rem',
              transition: 'all 0.2s'
            }}>
              <svg width="20" height="20" viewBox="0 0 48 48">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
              </svg>
              {t.loginWithGoogle}
            </button>

            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.25rem' }}>
              <div style={{ flex: 1, height: '1px', background: '#e5e7eb' }} />
              <span style={{ color: '#9ca3af', fontSize: '0.85rem' }}>or</span>
              <div style={{ flex: 1, height: '1px', background: '#e5e7eb' }} />
            </div>

            {/* Email Form */}
            <form onSubmit={handleEmailAuth}>
              <div style={{ marginBottom: '1rem' }}>
                <label style={{ display: 'block', fontWeight: '600', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                  {t.email}
                </label>
                <div style={{ position: 'relative' }}>
                  <Mail size={18} color="#9ca3af" style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)' }} />
                  <input
                    type="email" required value={email}
                    onChange={e => setEmail(e.target.value)}
                    placeholder="you@example.com"
                    style={{
                      width: '100%', padding: '0.75rem 0.75rem 0.75rem 2.5rem',
                      border: '1.5px solid #e5e7eb', borderRadius: '10px',
                      fontFamily: 'inherit', outline: 'none'
                    }}
                  />
                </div>
              </div>

              <div style={{ marginBottom: isLogin ? '1.5rem' : '1rem' }}>
                <label style={{ display: 'block', fontWeight: '600', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                  {t.password}
                </label>
                <div style={{ position: 'relative' }}>
                  <Lock size={18} color="#9ca3af" style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)' }} />
                  <input
                    type={showPassword ? 'text' : 'password'} required value={password}
                    onChange={e => setPassword(e.target.value)}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    style={{
                      width: '100%', padding: '0.75rem 2.5rem 0.75rem 2.5rem',
                      border: '1.5px solid #e5e7eb', borderRadius: '10px',
                      fontFamily: 'inherit', outline: 'none'
                    }}
                  />
                  <button type="button" onClick={() => setShowPassword(!showPassword)} style={{
                    position: 'absolute', right: '12px', top: '50%', transform: 'translateY(-50%)',
                    background: 'none', border: 'none', cursor: 'pointer', padding: 0
                  }}>
                    {showPassword ? <EyeOff size={18} color="#9ca3af" /> : <Eye size={18} color="#9ca3af" />}
                  </button>
                </div>
              </div>

              {!isLogin && (
                <div style={{ marginBottom: '1.5rem' }}>
                  <label style={{ display: 'block', fontWeight: '600', fontSize: '0.85rem', marginBottom: '0.5rem' }}>
                    {t.confirmPassword}
                  </label>
                  <div style={{ position: 'relative' }}>
                    <Lock size={18} color="#9ca3af" style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)' }} />
                    <input
                      type={showPassword ? 'text' : 'password'} required value={confirmPassword}
                      onChange={e => setConfirmPassword(e.target.value)}
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      style={{
                        width: '100%', padding: '0.75rem 0.75rem 0.75rem 2.5rem',
                        border: '1.5px solid #e5e7eb', borderRadius: '10px',
                        fontFamily: 'inherit', outline: 'none'
                      }}
                    />
                  </div>
                </div>
              )}

              {error && (
                <div style={{
                  background: '#fee2e2', color: '#dc2626', padding: '0.75rem 1rem',
                  borderRadius: '8px', fontSize: '0.85rem', marginBottom: '1rem'
                }}>
                  {error}
                </div>
              )}

              <button type="submit" disabled={loading} style={{
                width: '100%', padding: '0.875rem',
                background: loading ? '#d1d5db' : 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                color: 'white', border: 'none', borderRadius: '12px',
                fontWeight: '700', fontSize: '1rem', cursor: loading ? 'not-allowed' : 'pointer',
                boxShadow: loading ? 'none' : '0 4px 12px rgba(16, 185, 129, 0.3)'
              }}>
                {loading ? t.loading : (isLogin ? t.login : t.signup)}
              </button>
            </form>

            <p style={{ textAlign: 'center', marginTop: '1.5rem', fontSize: '0.9rem', color: '#6b7280' }}>
              {isLogin ? t.noAccount : t.haveAccount}{' '}
              <button onClick={() => { setIsLogin(!isLogin); setError(''); }} style={{
                background: 'none', border: 'none', color: '#10b981', fontWeight: '700',
                cursor: 'pointer', padding: 0, fontSize: '0.9rem'
              }}>
                {isLogin ? t.signup : t.login}
              </button>
            </p>
          </div>
        </div>
      );
    };

    // ===== MAIN APP =====
    const HomeStock = ({ user, language, setLanguage }) => {
      const [items, setItems] = useState([]);
      const [showAddForm, setShowAddForm] = useState(false);
      const [searchQuery, setSearchQuery] = useState('');
      const [filterCategory, setFilterCategory] = useState('all');
      const [filterLocation, setFilterLocation] = useState('all');
      const [showNotifications, setShowNotifications] = useState(false);
      const [showUpgradeModal, setShowUpgradeModal] = useState(false);
      const [showInstallPrompt, setShowInstallPrompt] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [loading, setLoading] = useState(true);

      const t = translations[language];
      const MAX_FREE_ITEMS = 30;

      const [formData, setFormData] = useState({
        name: '', category: 'food', quantity: 1, price: '',
        purchaseDate: new Date().toISOString().split('T')[0],
        expiryDate: '', location: 'refrigerator', store: '', notes: ''
      });

      const categories = [
        { id: 'food', name: t.categories.food, icon: 'üçé', color: '#10b981' },
        { id: 'appliance', name: t.categories.appliance, icon: 'üì±', color: '#3b82f6' },
        { id: 'daily', name: t.categories.daily, icon: 'üß¥', color: '#f59e0b' }
      ];

      const locations = [
        { id: 'refrigerator', name: t.locations.refrigerator },
        { id: 'freezer', name: t.locations.freezer },
        { id: 'pantry', name: t.locations.pantry },
        { id: 'kitchen', name: t.locations.kitchen },
        { id: 'bathroom', name: t.locations.bathroom },
        { id: 'storage', name: t.locations.storage },
        { id: 'other', name: t.locations.other }
      ];

      // Ê±∫Ê∏àÂÆå‰∫ÜÈÄöÁü•
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        if (params.get('payment') === 'success') {
          alert(language === 'ja' ? 'üéâ „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÂÆå‰∫ÜÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ' : 'üéâ Upgrade complete! Thank you.');
          window.history.replaceState({}, '', window.location.pathname);
        } else if (params.get('payment') === 'cancel') {
          window.history.replaceState({}, '', window.location.pathname);
        }
      }, []);

      // Load items from Firestore
      useEffect(() => {
        if (!user) return;
        setLoading(true);
        const unsubscribe = db.collection('users').doc(user.uid).collection('items')
          .orderBy('createdAt', 'desc')
          .onSnapshot(snapshot => {
            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setItems(data);
            setLoading(false);
          }, err => {
            console.error(err);
            setLoading(false);
          });
        return () => unsubscribe();
      }, [user]);

      // PWA Install prompt
      useEffect(() => {
        const handler = (e) => { e.preventDefault(); setDeferredPrompt(e); setShowInstallPrompt(true); };
        window.addEventListener('beforeinstallprompt', handler);
        return () => window.removeEventListener('beforeinstallprompt', handler);
      }, []);

      const toggleLanguage = () => {
        const newLang = language === 'ja' ? 'en' : 'ja';
        setLanguage(newLang);
        localStorage.setItem('homestock_language', newLang);
      };

      const handleLogout = () => auth.signOut();

      const handleInstallClick = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') setShowInstallPrompt(false);
        setDeferredPrompt(null);
      };

      const getExpiryStatus = (expiryDate) => {
        if (!expiryDate) return null;
        const today = new Date();
        const expiry = new Date(expiryDate);
        const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
        if (diffDays < 0) return { status: 'expired', text: t.expired, color: '#ef4444' };
        if (diffDays === 0) return { status: 'today', text: t.expiryToday, color: '#f59e0b' };
        if (diffDays <= 3) return { status: 'warning', text: t.daysLeft.replace('{days}', diffDays), color: '#f59e0b' };
        if (diffDays <= 7) return { status: 'soon', text: t.daysLeft.replace('{days}', diffDays), color: '#fbbf24' };
        return { status: 'safe', text: t.daysLeft.replace('{days}', diffDays), color: '#10b981' };
      };

      const getExpiringItems = () => items.filter(item => {
        if (!item.expiryDate) return false;
        const status = getExpiryStatus(item.expiryDate);
        return status && ['expired', 'today', 'warning'].includes(status.status);
      }).sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (items.length >= MAX_FREE_ITEMS) { setShowUpgradeModal(true); return; }
        const newItem = { ...formData, createdAt: firebase.firestore.FieldValue.serverTimestamp() };
        await db.collection('users').doc(user.uid).collection('items').add(newItem);
        setFormData({
          name: '', category: 'food', quantity: 1, price: '',
          purchaseDate: new Date().toISOString().split('T')[0],
          expiryDate: '', location: 'refrigerator', store: '', notes: ''
        });
        setShowAddForm(false);
      };

      const handleDelete = async (id) => {
        if (window.confirm(t.deleteConfirm)) {
          await db.collection('users').doc(user.uid).collection('items').doc(id).delete();
        }
      };

      // StripeÊ±∫Ê∏à
      const handleStripeCheckout = async (plan) => {
        const stripe = Stripe('pk_test_51T5QmhKsRfeHX0L79mGkGTjyobidITVmTrLGCLIBxaAvXn2j4nO8VG4LWRjGlFQMCVYvB0fiO4OOLA2lhXNnxfHf00nfNWYCTk');
        const priceIds = {
          premium: 'price_1T5R36KsRfeHX0L7k9W8xwGW',
          pro: 'price_1T5R3lKsRfeHX0L7fnLO6Qax'
        };
        try {
          const { error } = await stripe.redirectToCheckout({
            lineItems: [{ price: priceIds[plan], quantity: 1 }],
            mode: 'subscription',
            successUrl: window.location.origin + '?payment=success',
            cancelUrl: window.location.origin + '?payment=cancel',
            customerEmail: user.email,
          });
          if (error) alert(error.message);
        } catch (err) {
          alert(language === 'ja' ? 'Ê±∫Ê∏à„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' : 'Failed to start checkout. Please try again.');
        }
      };

      const exportToCSV = () => {
        const headers = ['Name','Category','Quantity','Price','Purchase Date','Expiry Date','Location','Store','Notes'];
        const rows = items.map(item => [
          item.name, item.category, item.quantity, item.price || '',
          item.purchaseDate, item.expiryDate || '', item.location, item.store || '', item.notes || ''
        ]);
        const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `homestock_export_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };

      const filteredItems = items.filter(item => {
        const matchesSearch = item.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                              (item.store || '').toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = filterCategory === 'all' || item.category === filterCategory;
        const matchesLocation = filterLocation === 'all' || item.location === filterLocation;
        return matchesSearch && matchesCategory && matchesLocation;
      });

      const getCategoryInfo = (categoryId) => categories.find(c => c.id === categoryId);
      const getLocationName = (locationId) => locations.find(l => l.id === locationId)?.name || locationId;
      const expiringItems = getExpiringItems();
      const remainingItems = MAX_FREE_ITEMS - items.length;

      return (
        <div style={{
          minHeight: '100vh',
          background: 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #f0fdfa 100%)',
          fontFamily: "'Outfit', -apple-system, BlinkMacSystemFont, sans-serif",
          paddingBottom: 'env(safe-area-inset-bottom)'
        }}>
          {/* Header */}
          <header style={{
            background: 'rgba(255,255,255,0.95)', backdropFilter: 'blur(10px)',
            borderBottom: '1px solid rgba(16,185,129,0.1)',
            padding: '1rem 1.5rem',
            paddingTop: 'calc(1rem + env(safe-area-inset-top))',
            position: 'sticky', top: 0, zIndex: 100,
            boxShadow: '0 2px 12px rgba(0,0,0,0.04)'
          }}>
            <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                <div style={{
                  width: '40px', height: '40px',
                  background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                  borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center',
                  boxShadow: '0 4px 12px rgba(16,185,129,0.3)'
                }}>
                  <Package color="white" size={24} />
                </div>
                <div>
                  <h1 style={{
                    fontSize: '1.5rem', fontWeight: '700', margin: 0,
                    background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                    WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent',
                    letterSpacing: '-0.02em'
                  }}>
                    {t.appName}
                  </h1>
                  {/* „É¶„Éº„Ç∂„ÉºÂêçË°®Á§∫ */}
                  <p style={{ fontSize: '0.7rem', color: '#6b7280', margin: 0 }}>
                    {user.displayName || user.email}
                  </p>
                </div>
              </div>

              <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                <button onClick={toggleLanguage} style={{
                  background: 'white', border: '1px solid #e5e7eb', borderRadius: '10px',
                  padding: '0.5rem', cursor: 'pointer', display: 'flex', alignItems: 'center',
                  gap: '0.25rem', fontSize: '0.75rem', fontWeight: '600'
                }}>
                  <Globe size={16} />{language.toUpperCase()}
                </button>

                <button onClick={() => setShowNotifications(!showNotifications)} style={{
                  background: expiringItems.length > 0 ? '#fef3c7' : 'white',
                  border: '1px solid #e5e7eb', borderRadius: '10px',
                  padding: '0.5rem', cursor: 'pointer', display: 'flex', alignItems: 'center', position: 'relative'
                }}>
                  <Bell size={20} color={expiringItems.length > 0 ? '#f59e0b' : '#6b7280'} />
                  {expiringItems.length > 0 && (
                    <span style={{
                      position: 'absolute', top: '-4px', right: '-4px',
                      background: '#ef4444', color: 'white', borderRadius: '50%',
                      width: '20px', height: '20px', display: 'flex', alignItems: 'center',
                      justifyContent: 'center', fontSize: '0.7rem', fontWeight: '700'
                    }}>{expiringItems.length}</span>
                  )}
                </button>

                <button
                  onClick={() => items.length >= MAX_FREE_ITEMS ? setShowUpgradeModal(true) : setShowAddForm(true)}
                  style={{
                    background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                    color: 'white', border: 'none', borderRadius: '10px',
                    padding: '0.5rem 1rem', cursor: 'pointer', display: 'flex', alignItems: 'center',
                    gap: '0.5rem', fontWeight: '600', fontSize: '0.9rem',
                    boxShadow: '0 4px 12px rgba(16,185,129,0.3)'
                  }}
                >
                  <Plus size={20} />{t.add}
                </button>

                <button onClick={handleLogout} title={t.logout} style={{
                  background: 'white', border: '1px solid #e5e7eb', borderRadius: '10px',
                  padding: '0.5rem', cursor: 'pointer', display: 'flex', alignItems: 'center'
                }}>
                  <LogOut size={18} color="#6b7280" />
                </button>
              </div>
            </div>
          </header>

          {/* Install Prompt */}
          {showInstallPrompt && (
            <div className="install-prompt" style={{
              position: 'fixed', bottom: '20px', left: '20px', right: '20px',
              background: 'white', borderRadius: '16px', padding: '1.5rem',
              boxShadow: '0 10px 40px rgba(0,0,0,0.15)', zIndex: 200, maxWidth: '400px', margin: '0 auto'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>
                <div>
                  <h3 style={{ margin: '0 0 0.5rem 0', fontSize: '1.1rem', fontWeight: '700' }}>üì± {t.installApp}</h3>
                  <p style={{ margin: 0, fontSize: '0.9rem', color: '#6b7280' }}>{t.installDesc}</p>
                </div>
                <button onClick={() => setShowInstallPrompt(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                  <X size={20} color="#9ca3af" />
                </button>
              </div>
              <div style={{ display: 'flex', gap: '0.75rem' }}>
                <button onClick={() => setShowInstallPrompt(false)} style={{
                  flex: 1, padding: '0.75rem', background: '#f3f4f6', border: 'none',
                  borderRadius: '10px', fontSize: '0.9rem', fontWeight: '600', cursor: 'pointer'
                }}>{t.later}</button>
                <button onClick={handleInstallClick} style={{
                  flex: 1, padding: '0.75rem',
                  background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                  color: 'white', border: 'none', borderRadius: '10px',
                  fontSize: '0.9rem', fontWeight: '600', cursor: 'pointer'
                }}>{t.install}</button>
              </div>
            </div>
          )}

          {/* Notifications Panel */}
          {showNotifications && (
            <div style={{
              position: 'fixed', top: 'calc(80px + env(safe-area-inset-top))', right: '20px',
              background: 'white', borderRadius: '16px', padding: '1.5rem',
              boxShadow: '0 10px 40px rgba(0,0,0,0.15)', zIndex: 200,
              width: '320px', maxWidth: 'calc(100vw - 40px)', maxHeight: '400px', overflowY: 'auto'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                <h3 style={{ margin: 0, fontSize: '1.1rem', fontWeight: '700' }}>üîî {t.expiryNotifications}</h3>
                <button onClick={() => setShowNotifications(false)} style={{ background: 'none', border: 'none', cursor: 'pointer' }}>
                  <X size={20} />
                </button>
              </div>
              {expiringItems.length === 0 ? (
                <p style={{ color: '#6b7280', textAlign: 'center', padding: '1rem 0' }}>{t.noExpiring}</p>
              ) : (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                  {expiringItems.map(item => {
                    const expiryInfo = getExpiryStatus(item.expiryDate);
                    return (
                      <div key={item.id} style={{
                        padding: '0.75rem', background: '#f9fafb', borderRadius: '8px',
                        borderLeft: `3px solid ${expiryInfo.color}`
                      }}>
                        <div style={{ fontWeight: '600', marginBottom: '0.25rem' }}>{item.name}</div>
                        <div style={{ fontSize: '0.85rem', color: expiryInfo.color, fontWeight: '600' }}>{expiryInfo.text}</div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          )}

          {/* Main Content */}
          <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem 1.5rem' }}>

            {/* Loading */}
            {loading && (
              <div style={{ textAlign: 'center', padding: '3rem', color: '#6b7280' }}>
                <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>‚è≥</div>
                {t.syncingData}
              </div>
            )}

            {!loading && <>
              {/* Free Plan Banner */}
              {remainingItems <= 10 && remainingItems > 0 && (
                <div style={{
                  background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',
                  borderRadius: '16px', padding: '1rem 1.5rem', marginBottom: '1.5rem',
                  display: 'flex', justifyContent: 'space-between', alignItems: 'center',
                  border: '1px solid #fbbf24'
                }}>
                  <div>
                    <div style={{ fontWeight: '700', marginBottom: '0.25rem' }}>
                      {t.itemsRemaining.replace('{count}', remainingItems)}
                    </div>
                    <div style={{ fontSize: '0.85rem', color: '#92400e' }}>{t.upgradePrompt}</div>
                  </div>
                  <button onClick={() => setShowUpgradeModal(true)} style={{
                    background: '#f59e0b', color: 'white', border: 'none', borderRadius: '8px',
                    padding: '0.5rem 1rem', fontWeight: '600', cursor: 'pointer',
                    display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem'
                  }}>
                    <Crown size={16} />{t.upgrade}
                  </button>
                </div>
              )}

              {/* Stats Cards */}
              <div style={{
                display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                gap: '1rem', marginBottom: '2rem'
              }}>
                {categories.map(cat => {
                  const count = items.filter(item => item.category === cat.id).length;
                  return (
                    <div key={cat.id} style={{
                      background: 'white', borderRadius: '16px', padding: '1.5rem',
                      boxShadow: '0 2px 8px rgba(0,0,0,0.04)', border: '1px solid rgba(0,0,0,0.05)'
                    }}>
                      <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{cat.icon}</div>
                      <div style={{ fontSize: '0.85rem', color: '#6b7280', marginBottom: '0.25rem' }}>{cat.name}</div>
                      <div style={{ fontSize: '1.75rem', fontWeight: '700', color: cat.color }}>{count}</div>
                    </div>
                  );
                })}
              </div>

              {/* Search and Filters */}
              <div style={{
                background: 'white', borderRadius: '16px', padding: '1.5rem',
                marginBottom: '2rem', boxShadow: '0 2px 8px rgba(0,0,0,0.04)',
                border: '1px solid rgba(0,0,0,0.05)'
              }}>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                  <div style={{ position: 'relative' }}>
                    <Search style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#9ca3af' }} size={20} />
                    <input
                      type="text" placeholder={t.searchPlaceholder} value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                      style={{
                        width: '100%', padding: '0.75rem 1rem 0.75rem 2.75rem',
                        border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit'
                      }}
                    />
                  </div>
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                    <select value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}
                      style={{ padding: '0.75rem 1rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', cursor: 'pointer', fontFamily: 'inherit' }}>
                      <option value="all">{t.allCategories}</option>
                      {categories.map(cat => <option key={cat.id} value={cat.id}>{cat.icon} {cat.name}</option>)}
                    </select>
                    <select value={filterLocation} onChange={(e) => setFilterLocation(e.target.value)}
                      style={{ padding: '0.75rem 1rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', cursor: 'pointer', fontFamily: 'inherit' }}>
                      <option value="all">{t.allLocations}</option>
                      {locations.map(loc => <option key={loc.id} value={loc.id}>{loc.name}</option>)}
                    </select>
                  </div>
                  {items.length > 0 && (
                    <button onClick={exportToCSV} style={{
                      padding: '0.75rem', background: '#f3f4f6', border: '1px solid #e5e7eb',
                      borderRadius: '10px', fontSize: '0.9rem', fontWeight: '600', cursor: 'pointer',
                      display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem'
                    }}>
                      <Download size={18} />{t.exportData}
                    </button>
                  )}
                </div>
              </div>

              {/* Items List */}
              {filteredItems.length === 0 ? (
                <div style={{
                  background: 'white', borderRadius: '16px', padding: '4rem 2rem',
                  textAlign: 'center', boxShadow: '0 2px 8px rgba(0,0,0,0.04)'
                }}>
                  <Package size={64} color="#d1d5db" style={{ margin: '0 auto 1rem' }} />
                  <h3 style={{ color: '#6b7280', fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                    {searchQuery || filterCategory !== 'all' || filterLocation !== 'all' ? t.noResults : t.noItems}
                  </h3>
                  <p style={{ color: '#9ca3af', fontSize: '0.9rem' }}>
                    {searchQuery || filterCategory !== 'all' || filterLocation !== 'all' ? t.noResultsDesc : t.noItemsDesc}
                  </p>
                </div>
              ) : (
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {filteredItems.map(item => {
                    const categoryInfo = getCategoryInfo(item.category);
                    const expiryInfo = item.expiryDate ? getExpiryStatus(item.expiryDate) : null;
                    return (
                      <div key={item.id} style={{
                        background: 'white', borderRadius: '16px', padding: '1.5rem',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.04)', border: '1px solid rgba(0,0,0,0.05)'
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                          <div style={{ flex: 1 }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.75rem', flexWrap: 'wrap' }}>
                              {categoryInfo && (
                                <span style={{
                                  background: `${categoryInfo.color}15`, color: categoryInfo.color,
                                  padding: '0.25rem 0.75rem', borderRadius: '6px', fontSize: '0.75rem', fontWeight: '600'
                                }}>
                                  {categoryInfo.icon} {categoryInfo.name}
                                </span>
                              )}
                              {expiryInfo && (
                                <span style={{
                                  background: `${expiryInfo.color}15`, color: expiryInfo.color,
                                  padding: '0.25rem 0.75rem', borderRadius: '6px', fontSize: '0.75rem', fontWeight: '600'
                                }}>
                                  <Calendar size={12} style={{ display: 'inline', marginRight: '4px', verticalAlign: 'middle' }} />
                                  {expiryInfo.text}
                                </span>
                              )}
                            </div>
                            <h3 style={{ fontSize: '1.25rem', fontWeight: '700', marginBottom: '0.75rem', color: '#111827' }}>
                              {item.name}
                            </h3>
                            <div style={{
                              display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                              gap: '0.75rem', fontSize: '0.85rem', color: '#6b7280'
                            }}>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                <Package size={16} color="#9ca3af" />
                                <span>{t.quantity}: {item.quantity}</span>
                              </div>
                              {item.price && (
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                  <Tag size={16} color="#9ca3af" />
                                  <span>{language === 'ja' ? '¬•' : '$'}{parseInt(item.price).toLocaleString()}</span>
                                </div>
                              )}
                              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                <MapPin size={16} color="#9ca3af" />
                                <span>{getLocationName(item.location)}</span>
                              </div>
                              {item.store && (
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                  <ShoppingCart size={16} color="#9ca3af" />
                                  <span>{item.store}</span>
                                </div>
                              )}
                              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                <Calendar size={16} color="#9ca3af" />
                                <span>{item.purchaseDate}</span>
                              </div>
                            </div>
                            {item.notes && (
                              <div style={{
                                marginTop: '0.75rem', padding: '0.75rem', background: '#f9fafb',
                                borderRadius: '8px', fontSize: '0.85rem', color: '#6b7280'
                              }}>
                                {item.notes}
                              </div>
                            )}
                          </div>
                          <button onClick={() => handleDelete(item.id)} style={{
                            background: '#fee2e2', border: 'none', borderRadius: '8px',
                            padding: '0.5rem', cursor: 'pointer', marginLeft: '1rem', flexShrink: 0
                          }}>
                            <Trash2 size={18} color="#ef4444" />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </>}
          </main>

          {/* Add Form Modal */}
          {showAddForm && (
            <div style={{
              position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
              background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center',
              justifyContent: 'center', zIndex: 300, padding: '1rem'
            }} onClick={() => setShowAddForm(false)}>
              <div style={{
                background: 'white', borderRadius: '20px', padding: '2rem',
                maxWidth: '600px', width: '100%', maxHeight: '90vh', overflowY: 'auto',
                boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
              }} onClick={e => e.stopPropagation()}>
                <h2 style={{ fontSize: '1.5rem', fontWeight: '700', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                  <Plus size={28} color="#10b981" />{t.addItem}
                </h2>
                <form onSubmit={handleSubmit}>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.itemName} *</label>
                      <input type="text" required value={formData.name}
                        onChange={e => setFormData({...formData, name: e.target.value})}
                        placeholder={t.itemNamePlaceholder}
                        style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                      />
                    </div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.category}</label>
                        <select value={formData.category} onChange={e => setFormData({...formData, category: e.target.value})}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', cursor: 'pointer', fontFamily: 'inherit' }}>
                          {categories.map(cat => <option key={cat.id} value={cat.id}>{cat.icon} {cat.name}</option>)}
                        </select>
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.quantity}</label>
                        <input type="number" min="1" value={formData.quantity}
                          onChange={e => setFormData({...formData, quantity: e.target.value})}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                        />
                      </div>
                    </div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.price}</label>
                        <input type="number" value={formData.price}
                          onChange={e => setFormData({...formData, price: e.target.value})}
                          placeholder={t.optional}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                        />
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.purchaseDate}</label>
                        <input type="date" value={formData.purchaseDate}
                          onChange={e => setFormData({...formData, purchaseDate: e.target.value})}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                        />
                      </div>
                    </div>
                    {formData.category === 'food' && (
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.expiryDate}</label>
                        <input type="date" value={formData.expiryDate}
                          onChange={e => setFormData({...formData, expiryDate: e.target.value})}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                        />
                      </div>
                    )}
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.location}</label>
                        <select value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', cursor: 'pointer', fontFamily: 'inherit' }}>
                          {locations.map(loc => <option key={loc.id} value={loc.id}>{loc.name}</option>)}
                        </select>
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.store}</label>
                        <input type="text" value={formData.store}
                          onChange={e => setFormData({...formData, store: e.target.value})}
                          placeholder={t.storePlaceholder}
                          style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit' }}
                        />
                      </div>
                    </div>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: '600', fontSize: '0.9rem' }}>{t.notes}</label>
                      <textarea value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})}
                        placeholder={t.notesPlaceholder} rows="3"
                        style={{ width: '100%', padding: '0.75rem', border: '1px solid #e5e7eb', borderRadius: '10px', fontSize: '16px', fontFamily: 'inherit', resize: 'vertical' }}
                      />
                    </div>
                    <div style={{ display: 'flex', gap: '1rem', marginTop: '0.5rem' }}>
                      <button type="button" onClick={() => setShowAddForm(false)} style={{
                        flex: 1, padding: '0.875rem', background: '#f3f4f6', border: 'none',
                        borderRadius: '10px', fontSize: '16px', fontWeight: '600', cursor: 'pointer'
                      }}>{t.cancel}</button>
                      <button type="submit" style={{
                        flex: 1, padding: '0.875rem',
                        background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        color: 'white', border: 'none', borderRadius: '10px',
                        fontSize: '16px', fontWeight: '600', cursor: 'pointer',
                        boxShadow: '0 4px 12px rgba(16,185,129,0.3)'
                      }}>{t.addButton}</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          )}

          {/* Upgrade Modal */}
          {showUpgradeModal && (
            <div style={{
              position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
              background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center',
              justifyContent: 'center', zIndex: 300, padding: '1rem'
            }} onClick={() => setShowUpgradeModal(false)}>
              <div style={{
                background: 'white', borderRadius: '20px', padding: '2rem',
                maxWidth: '600px', width: '100%', maxHeight: '90vh', overflowY: 'auto',
                boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
              }} onClick={e => e.stopPropagation()}>
                <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                  <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üëë</div>
                  <h2 style={{ fontSize: '1.75rem', fontWeight: '700', marginBottom: '0.5rem' }}>
                    {language === 'ja' ? '„Éó„É©„É≥„Çí„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ' : 'Upgrade Your Plan'}
                  </h2>
                  <p style={{ color: '#6b7280', fontSize: '0.95rem' }}>
                    {language === 'ja' ? '„Çà„ÇäÂ§ö„Åè„ÅÆÊ©üËÉΩ„Åß„Éõ„Éº„É†„Çπ„Éà„ÉÉ„ÇØ„ÇíÊ¥ªÁî®„Åó„Åæ„Åó„Çá„ÅÜ' : 'Unlock more features for your home inventory'}
                  </p>
                </div>

                <div style={{ display: 'grid', gap: '1rem', marginBottom: '1.5rem' }}>
                  {/* Free Plan */}
                  <div style={{ border: '2px solid #e5e7eb', borderRadius: '16px', padding: '1.5rem' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                      <div style={{ fontWeight: '700', fontSize: '1.1rem' }}>{t.freePlan}</div>
                      <div style={{ fontSize: '1.5rem', fontWeight: '700' }}>¬•0</div>
                    </div>
                    <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                      {[
                        language === 'ja' ? '30„Ç¢„Ç§„ÉÜ„É†„Åæ„Åß' : 'Up to 30 items',
                        language === 'ja' ? 'Âü∫Êú¨ÁöÑ„Å™Âú®Â∫´ÁÆ°ÁêÜ' : 'Basic inventory management',
                        language === 'ja' ? 'CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà' : 'CSV export',
                      ].map((f, i) => (
                        <li key={i} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem', color: '#6b7280' }}>
                          <Check size={16} color="#10b981" />{f}
                        </li>
                      ))}
                    </ul>
                    <div style={{ marginTop: '1rem', padding: '0.75rem', background: '#f3f4f6', borderRadius: '8px', textAlign: 'center', fontSize: '0.9rem', color: '#6b7280', fontWeight: '600' }}>
                      {language === 'ja' ? 'ÁèæÂú®„ÅÆ„Éó„É©„É≥' : 'Current Plan'}
                    </div>
                  </div>

                  {/* Premium Plan */}
                  <div style={{ border: '2px solid #10b981', borderRadius: '16px', padding: '1.5rem', background: 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%)', position: 'relative' }}>
                    <div style={{
                      position: 'absolute', top: '-12px', left: '50%', transform: 'translateX(-50%)',
                      background: '#10b981', color: 'white', padding: '0.25rem 1rem',
                      borderRadius: '20px', fontSize: '0.75rem', fontWeight: '700'
                    }}>
                      {language === 'ja' ? '‰∫∫Ê∞óNo.1' : 'Most Popular'}
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                      <div style={{ fontWeight: '700', fontSize: '1.1rem' }}>{t.premiumPlan}</div>
                      <div>
                        <span style={{ fontSize: '1.5rem', fontWeight: '700' }}>¬•480</span>
                        <span style={{ fontSize: '0.85rem', color: '#6b7280' }}>{t.perMonth}</span>
                      </div>
                    </div>
                    <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '0.5rem', marginBottom: '1rem' }}>
                      {[
                        language === 'ja' ? '„Ç¢„Ç§„ÉÜ„É†ÁÑ°Âà∂Èôê' : 'Unlimited items',
                        language === 'ja' ? '„Éê„Éº„Ç≥„Éº„Éâ„Çπ„Ç≠„É£„É≥' : 'Barcode scanning',
                        language === 'ja' ? 'ÂÆ∂ÊóèÂÖ±ÊúâÔºà5‰∫∫„Åæ„ÅßÔºâ' : 'Family sharing (up to 5)',
                        language === 'ja' ? '„É¨„Ç∑„Éº„ÉàOCRÔºàÊúà10ÊûöÔºâ' : 'Receipt OCR (10/month)',
                        language === 'ja' ? 'ÂÑ™ÂÖà„Çµ„Éù„Éº„Éà' : 'Priority support',
                      ].map((f, i) => (
                        <li key={i} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem' }}>
                          <Check size={16} color="#10b981" />{f}
                        </li>
                      ))}
                    </ul>
                    <button
                      onClick={() => handleStripeCheckout('premium')}
                      style={{
                        width: '100%', padding: '0.875rem',
                        background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        color: 'white', border: 'none', borderRadius: '10px',
                        fontWeight: '700', fontSize: '1rem', cursor: 'pointer',
                        boxShadow: '0 4px 12px rgba(16,185,129,0.3)'
                      }}
                    >
                      {language === 'ja' ? '„Éó„É¨„Éü„Ç¢„É†„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ' : 'Upgrade to Premium'}
                    </button>
                  </div>

                  {/* Pro Plan */}
                  <div style={{ border: '2px solid #6366f1', borderRadius: '16px', padding: '1.5rem' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                      <div style={{ fontWeight: '700', fontSize: '1.1rem' }}>{t.proPlan}</div>
                      <div>
                        <span style={{ fontSize: '1.5rem', fontWeight: '700' }}>¬•980</span>
                        <span style={{ fontSize: '0.85rem', color: '#6b7280' }}>{t.perMonth}</span>
                      </div>
                    </div>
                    <ul style={{ listStyle: 'none', padding: 0, margin: 0, display: 'flex', flexDirection: 'column', gap: '0.5rem', marginBottom: '1rem' }}>
                      {[
                        language === 'ja' ? '„Éó„É¨„Éü„Ç¢„É†„ÅÆÂÖ®Ê©üËÉΩ' : 'All Premium features',
                        language === 'ja' ? '„É¨„Ç∑„Éº„ÉàOCRÁÑ°Âà∂Èôê' : 'Unlimited receipt OCR',
                        language === 'ja' ? 'Ë≥ºË≤∑ÂàÜÊûê„É¨„Éù„Éº„Éà' : 'Purchase analytics',
                        language === 'ja' ? 'APIÈÄ£Êê∫' : 'API integration',
                        language === 'ja' ? 'Â∞Ç‰ªª„Çµ„Éù„Éº„Éà' : 'Dedicated support',
                      ].map((f, i) => (
                        <li key={i} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem' }}>
                          <Check size={16} color="#6366f1" />{f}
                        </li>
                      ))}
                    </ul>
                    <button
                      onClick={() => handleStripeCheckout('pro')}
                      style={{
                        width: '100%', padding: '0.875rem',
                        background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',
                        color: 'white', border: 'none', borderRadius: '10px',
                        fontWeight: '700', fontSize: '1rem', cursor: 'pointer',
                        boxShadow: '0 4px 12px rgba(99,102,241,0.3)'
                      }}
                    >
                      {language === 'ja' ? '„Éó„É≠„Å´„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ' : 'Upgrade to Pro'}
                    </button>
                  </div>
                </div>

                <button onClick={() => setShowUpgradeModal(false)} style={{
                  width: '100%', padding: '0.875rem', background: '#f3f4f6', border: 'none',
                  borderRadius: '10px', fontSize: '1rem', fontWeight: '600', cursor: 'pointer'
                }}>{t.cancel}</button>
              </div>
            </div>
          )}

          {/* Footer */}
          <footer style={{
            borderTop: '1px solid rgba(0,0,0,0.06)',
            padding: '1.5rem',
            textAlign: 'center',
            marginTop: '1rem'
          }}>
            <div style={{ display: 'flex', justifyContent: 'center', gap: '1.5rem', flexWrap: 'wrap', fontSize: '0.8rem', color: '#9ca3af' }}>
              <span>¬© 2026 Ê†™Âºè‰ºöÁ§æ„Éè„Ç§„Çø„ÉÉ„ÉÅ</span>
              <a href="/privacy.html" style={{ color: '#9ca3af', textDecoration: 'none' }}
                onMouseOver={e => e.target.style.color='#10b981'}
                onMouseOut={e => e.target.style.color='#9ca3af'}>
                „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº
              </a>
              <a href="/tokushoho.html" style={{ color: '#9ca3af', textDecoration: 'none' }}
                onMouseOver={e => e.target.style.color='#10b981'}
                onMouseOut={e => e.target.style.color='#9ca3af'}>
                ÁâπÂÆöÂïÜÂèñÂºïÊ≥ï„Å´Âü∫„Å•„ÅèË°®Ë®ò
              </a>
              <a href="mailto:goro@high-touch.jp" style={{ color: '#9ca3af', textDecoration: 'none' }}
                onMouseOver={e => e.target.style.color='#10b981'}
                onMouseOut={e => e.target.style.color='#9ca3af'}>
                „ÅäÂïè„ÅÑÂêà„Çè„Åõ
              </a>
            </div>
          </footer>

          <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet" />
        </div>
      );
    };

    // ===== ROOT APP =====
    const App = () => {
      const [user, setUser] = useState(undefined); // undefined = loading, null = not logged in
      const [language, setLanguage] = useState(() => {
        const saved = localStorage.getItem('homestock_language');
        if (saved) return saved;
        return navigator.language.startsWith('ja') ? 'ja' : 'en';
      });

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
        return () => unsubscribe();
      }, []);

      const toggleLanguage = () => {
        const newLang = language === 'ja' ? 'en' : 'ja';
        setLanguage(newLang);
        localStorage.setItem('homestock_language', newLang);
      };

      // Loading
      if (user === undefined) {
        return (
          <div style={{
            minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center',
            background: 'linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%)',
            fontFamily: 'sans-serif', color: '#6b7280', flexDirection: 'column', gap: '1rem'
          }}>
            <div style={{
              width: '56px', height: '56px',
              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
              borderRadius: '16px', display: 'flex', alignItems: 'center', justifyContent: 'center'
            }}>
              <Package color="white" size={32} />
            </div>
            <span>HomeStock</span>
          </div>
        );
      }

      if (!user) {
        return <AuthScreen language={language} onLanguageToggle={toggleLanguage} />;
      }

      return <HomeStock user={user} language={language} setLanguage={setLanguage} />;
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registered'))
          .catch(err => console.log('SW registration failed'));
      });
    }
  </script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAjHbBs0KJhKn7Xxjngt84GidqWqSHTDu0",
      authDomain: "homestock-4a4f0.firebaseapp.com",
      projectId: "homestock-4a4f0",
      storageBucket: "homestock-4a4f0.firebasestorage.app",
      messagingSenderId: "377612858891",
      appId: "1:377612858891:web:975d5b70bf09034310790e",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    db.enablePersistence().catch(err => console.log('Persistence:', err.code));
  </script>
</body>
</html>
